<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Leopard Low Down</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              brand: '#C1121F'
            }
          }
        }
      };
    </script>
    <style>
      :root {
        --brand: #C1121F
      }

      .masthead {
        letter-spacing: .02em;
      }

      .smallcaps {
        font-variant: all-small-caps;
        letter-spacing: .06em;
      }

      .font-helvetica {
        font-family: "Helvetica Neue", Helvetica, Arial, "Liberation Sans", sans-serif;
      }
  /* Toast */
  .toast-stack { position: fixed; bottom: 1rem; right: 1rem; display: flex; flex-direction: column; gap: .5rem; z-index: 50; }
  .toast { background:#111; color:#fff; padding:.5rem .75rem; font-size:.75rem; border-radius:4px; box-shadow:0 2px 6px rgba(0,0,0,.25); opacity:0; transform:translateY(4px); animation:toast-in .25s forwards; }
  @keyframes toast-in { to { opacity:1; transform:translateY(0); } }
  .toast.fade-out { animation: toast-out .3s forwards; }
  @keyframes toast-out { to { opacity:0; transform:translateY(4px); } }
  .tag-pill { display:inline-block; border:1px solid var(--brand); color:var(--brand); font-variant:all-small-caps; letter-spacing:.06em; font-size:10px; padding:2px 6px; line-height:1; border-radius:2px; background:rgba(193,18,31,0.06); }
    </style>
  </head>
  <body class="bg-white text-neutral-900">
    <!-- Meta bar (unchanged visual except consistent width) -->
    <div class="border-b border-neutral-200">
      <div class="mx-auto max-w-6xl md:max-w-7xl px-4 py-3 flex items-center justify-between">
        <span id="meta-pill" class="inline-flex items-center rounded-[3px] border border-neutral-300 bg-neutral-50 px-4 py-1.5 text-xs text-neutral-700"></span>
        <nav aria-label="Meta actions" class="inline-flex items-center rounded-[3px] border border-neutral-300 bg-neutral-50 px-3 py-1.5 text-xs text-neutral-700">
          <a href="LLD-Gallery.html" class="hover:text-[var(--brand)]">Search</a>
          <span class="mx-2 text-neutral-300">•</span>
          <a href="LLD-Gallery.html" class="hover:text-[var(--brand)]">Gallery</a>
        </nav>
      </div>
    </div>
    <!-- Masthead -->
    <header class="mx-auto max-w-6xl md:max-w-7xl px-4">
      <h1 class="masthead font-serif text-center text-5xl md:text-7xl font-extrabold tracking-tight py-6 md:py-8"> LEOPARD LOW DOWN </h1>
    </header>
    <!-- Top stories -->
<!-- Top stories (single pill, full-bleed band) -->
<div class="border-t border-neutral-200">
  <nav aria-label="Top stories" class="mx-auto max-w-6xl md:max-w-7xl px-4 py-2">
    <div class="rounded-[3px] border border-neutral-300 bg-neutral-50 px-3 py-1.5 flex flex-wrap items-center gap-2 md:gap-6">
      <span class="smallcaps text-[11px] text-neutral-600 shrink-0">Top stories:</span>
      <ul id="top-stories-bar" class="flex flex-wrap items-center gap-2 md:gap-0 md:divide-x md:divide-neutral-200 [&>li]:md:px-3"></ul>
    </div>
  </nav>
  <div class="border-b border-neutral-300"></div>
</div>

   <!-- Category nav (narrower) -->
<nav aria-label="Primary" class="border-b border-neutral-200 mt-1 font-helvetica">
  <div class="mx-auto max-w-5xl md:max-w-6xl px-4 py-3 flex items-baseline justify-between">
    <ul class="flex flex-wrap gap-x-6 gap-y-2 uppercase tracking-[0.06em] text-[13px] leading-6">
  <li><a class="hover:text-[var(--brand)]" href="LLD-Gallery.html?q=News">News</a></li>
  <li><a class="hover:text-[var(--brand)]" href="LLD-Gallery.html?q=Sports">Sports</a></li>
  <li><a class="hover:text-[var(--brand)]" href="LLD-Gallery.html?q=Features">Features</a></li>
  <li><a class="hover:text-[var(--brand)]" href="LLD-Gallery.html?q=Opinion">Opinion</a></li>
  <li><a class="hover:text-[var(--brand)]" href="LLD-Gallery.html?q=Photos">Photos</a></li>
  <li><a class="hover:text-[var(--brand)]" href="LLD-Gallery.html?q=History">History</a></li>
    </ul>
  <a class="text-xs font-bold uppercase tracking-[0.14em] text-[var(--brand)] leading-6 pb-[1px]" href="LLD-Gallery.html">Gallery</a>
  </div>
</nav>

    <!-- Main content -->
    <main class="mx-auto max-w-6xl md:max-w-7xl px-4 py-6 md:py-8 grid grid-cols-1 md:grid-cols-12 gap-6">
      <section class="md:col-span-12 space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
          <!-- Hero story and cards will be loaded dynamically -->
          <div id="homepage-articles" class="md:col-span-9"></div>

          <!-- Sidebar: stronger headers, clear rules; removed stray `right-` -->
          <!-- Sidebar -->
          <aside class="md:col-span-3 md:self-start" aria-label="Sidebar">
            <div class="border border-neutral-200 rounded-sm bg-white divide-y divide-neutral-200">
              <!-- Events -->
              <section>
                <header class="bg-neutral-50 border-b border-neutral-200 p-4">
                  <h3 class="text-xs smallcaps font-semibold text-neutral-800" >Upcoming Events</h3>
                </header>
                <ol id="events-list" class="p-4 space-y-1 text-sm list-decimal pl-7"></ol>
              </section>
              <!-- Weather -->
              <section>
                <header class="bg-neutral-50 border-b border-neutral-200 p-4">
                  <h3 class="text-xs smallcaps font-semibold text-neutral-800">Weather</h3>
                </header>
                <div class="p-4">
                  <p id="weather-summary" class="text-sm"></p>
                </div>
              </section>
              <!-- Scores -->
              <section>
                <header class="bg-neutral-50 border-b border-neutral-200 p-4">
                  <h3 class="text-xs smallcaps font-semibold text-neutral-800">Scores</h3>
                </header>
                <div class="p-4 bg-neutral-100" id="scores-section"></div>
              </section>
            </div>
          </aside>
        </div>
  <!-- Cards will be loaded dynamically -->
  <div id="homepage-cards" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"></div>
  <!-- Opinion & Editorial will be loaded dynamically -->
  <div id="homepage-opinion" class="grid md:grid-cols-2 gap-6"></div>
    <script>
      // Helper to format time posted
      function formatTimePosted(isoString) {
        const date = new Date(isoString);
        const now = new Date();
        const diffMs = now - date;
        const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
        if (diffDays === 0) {
          const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
          if (diffHours === 0) return 'Just now';
          if (diffHours === 1) return '1 hr ago';
          return diffHours + ' hr ago';
        }
        if (diffDays === 1) return 'Yesterday';
        return diffDays + ' Days Ago';
      }

      // Cache-bust to avoid stale catalog
      const ts = Date.now();
      fetch(`ArticleCatalog.json?ts=${ts}`)
        .then(res => res.json())
        .then(data => {
          const all = Array.isArray(data.articles) ? data.articles : [];
          // Only include items with a non-empty homepage_position
          const positioned = all.filter(a => (a.homepage_position ?? '').toString().trim() !== '');
          const articles = positioned.sort((a, b) => a.homepage_position.localeCompare(b.homepage_position));
          // Top Stories bar (positions 07, 08, 09)
          const topStories = articles.filter(a => ['07','08','09'].includes(a.homepage_position));
          const topStoriesBar = document.getElementById('top-stories-bar');
          topStoriesBar.innerHTML = topStories.map(a => {
            const url = `LLD-Article-Page.html?id=${encodeURIComponent(a.id)}`;
            return `<li><a class=\"hover:text-[var(--brand)]\" href="${url}">${a.title}</a></li>`;
          }).join('');

          // Hero story (first position)
          const hero = articles[0];
          if(!hero){
            document.getElementById('homepage-articles').innerHTML = '<div class="text-sm text-neutral-500">No positioned articles yet.</div>';
            return;
          }
          const heroUrl = `LLD-Article-Page.html?id=${encodeURIComponent(hero.id)}`;
          const heroImg = hero.imageUrl || `https://picsum.photos/seed/${encodeURIComponent(hero.id)}-hero/1200/650`;
          const heroAlt = hero.imageAlt || hero.title || 'Story image';
          document.getElementById('homepage-articles').innerHTML = `
            <article class="border border-neutral-200 rounded-sm overflow-hidden bg-white">
              <a href="${heroUrl}" class="block group">
                <div class="relative h-44 sm:h-52 md:h-56 lg:h-60 xl:h-64 bg-neutral-100 overflow-hidden">
                  <img src="${heroImg}" alt="${heroAlt}" loading="lazy" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-[1.03]" />
                </div>
              </a>
              <div class="border-t border-neutral-200 p-4 md:p-5">
                <span class="inline-flex items-center gap-2 text-[10px] uppercase tracking-widest text-neutral-600">
                  ${hero.category ? `<span class="tag-pill">${hero.category}</span>` : ''}
                </span>
                <h2 class="font-serif mt-1 md:mt-2 text-2xl md:text-3xl font-extrabold leading-tight">
                  <a href="${heroUrl}" class="hover:text-[var(--brand)]">${hero.title}</a>
                </h2>
                <p class="mt-1 text-xs text-neutral-500">${formatTimePosted(hero.time_posted)}</p>
                <div class="mt-3 flex flex-wrap gap-3">
                  <a href="${heroUrl}" class="inline-flex items-center justify-center rounded-[3px] bg-[var(--brand)] px-4 py-2 text-white text-sm font-medium hover:bg-[#a0101b]">Read story</a>
                  <button type="button" id="hero-share" class="inline-flex items-center justify-center rounded-[3px] border border-[var(--brand)] text-[var(--brand)] px-4 py-2 text-sm font-medium hover:bg-[rgba(193,18,31,0.08)] focus:outline-none focus:ring-2 focus:ring-[var(--brand)] focus:ring-offset-1">Share</button>
                </div>
              </div>
            </article>
          `;
          // Cards (positions 2-4)
          document.getElementById('homepage-cards').innerHTML = articles.slice(1, 4).map(a => {
            const url = `LLD-Article-Page.html?id=${encodeURIComponent(a.id)}`;
            const img = a.imageUrl || `https://picsum.photos/seed/${encodeURIComponent(a.id)}-card/600/400`;
            const alt = a.imageAlt || a.title || 'Story image';
            return `
            <a href="${url}" class="block group">
            <article class="border border-neutral-200 rounded-sm transition-shadow group-hover:shadow-md overflow-hidden bg-white">
              <div class="relative h-28 bg-neutral-100 overflow-hidden">
                <img src="${img}" alt="${alt}" loading="lazy" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-[1.05]" />
              </div>
              <div class="border-t border-neutral-200 p-4">
                ${a.category ? `<span class="tag-pill">${a.category}</span>` : ''}
                <h3 class="font-serif mt-2 font-semibold">${a.title}</h3>
                <p class="mt-1 text-xs text-neutral-500">${formatTimePosted(a.time_posted)}</p>
              </div>
            </article></a>`;
          }).join('');
          // Opinion & Editorial (positions 5-6)
          document.getElementById('homepage-opinion').innerHTML = articles.slice(4, 6).map(a => {
            const url = `LLD-Article-Page.html?id=${encodeURIComponent(a.id)}`;
            const img = a.imageUrl || `https://picsum.photos/seed/${encodeURIComponent(a.id)}-op/800/450`;
            const alt = a.imageAlt || a.title || 'Story image';
            return `
            <section class="border border-neutral-200 rounded-sm">
              <header class="bg-neutral-50 border-b border-neutral-200 p-4">
                <h3 class="text-xs smallcaps font-semibold text-neutral-900">${a.category ? `<span class="tag-pill">${a.category}</span>` : ''}</h3>
              </header>
              <div class="p-4">
                <a href="${url}" class="block group">
                <h4 class="font-serif font-semibold">${a.title}</h4>
                <p class="mt-1 text-xs text-neutral-500">${formatTimePosted(a.time_posted)}</p>
                <div class="mt-3 relative h-24 bg-neutral-100 border-t border-neutral-200 overflow-hidden">
                  <img src="${img}" alt="${alt}" loading="lazy" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-[1.05]" />
                </div>
                </a>
              </div>
            </section>
          `;
          }).join('');

          // Student & Staff Spotlights (separate data source)
          fetch('Spotlights.json')
            .then(r => r.json())
            .then(sData => {
              const wrap = document.getElementById('photo-essays');
              if(!wrap) return;
              const list = Array.isArray(sData?.spotlights) ? sData.spotlights.slice(0,4) : [];
              if(!list.length){
                wrap.innerHTML = '<p class="text-xs text-neutral-500">No spotlights available.</p>';
                return;
              }
              wrap.innerHTML = list.map(s => {
                const img = s.imageUrl || `https://picsum.photos/seed/${encodeURIComponent(s.id||'spot')}/400/400`;
                const alt = s.imageAlt || (s.name ? `Portrait of ${s.name}` : 'Spotlight portrait');
                const linkStart = s.link ? `<a href="${s.link}" class="group block focus:outline-none focus:ring-2 focus:ring-[var(--brand)] focus:ring-offset-2" aria-label="Read more about ${s.name}">` : '<div class="group block">';
                const linkEnd = s.link ? '</a>' : '</div>';
                return `${linkStart}
                  <article class="border border-neutral-200 rounded-sm overflow-hidden bg-white h-full flex flex-col">
                    <div class="relative h-40 sm:h-44 bg-neutral-100 overflow-hidden">
                      <img src="${img}" alt="${alt}" loading="lazy" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-[1.05]" />
                    </div>
                    <div class="border-t border-neutral-200 p-3 flex flex-col gap-1">
                      <h4 class="font-serif text-sm font-semibold leading-snug">${s.name || 'Unnamed'}</h4>
                      <p class="text-[11px] uppercase tracking-wide text-[var(--brand)] font-medium">${s.role || ''}</p>
                      <p class="text-xs text-neutral-600 leading-snug line-clamp-3">${s.blurb || ''}</p>
                    </div>
                  </article>
                ${linkEnd}`;
              }).join('');
            })
            .catch(()=>{
              const wrap = document.getElementById('photo-essays');
              if(wrap) wrap.innerHTML = '<p class="text-xs text-red-600">Failed to load spotlights.</p>';
            });
        });
    </script>
    <div class="toast-stack" id="toast-stack" aria-live="polite" aria-atomic="false"></div>
    <script>
      // Share & Toast helpers (home page)
      (function(){
        function pushToast(msg, ttl=3000){
          const stack = document.getElementById('toast-stack');
          if(!stack) return;
          const el = document.createElement('div');
          el.className = 'toast';
          el.textContent = msg;
          stack.appendChild(el);
          setTimeout(()=>{ el.classList.add('fade-out'); }, ttl-250);
          setTimeout(()=>{ el.remove(); }, ttl);
        }
        function share(url, title){
          if (navigator.share) {
            navigator.share({title, url}).catch(()=>{});
            return;
          }
          try {
            navigator.clipboard.writeText(url).then(()=>pushToast('Link copied')); 
          } catch {
            pushToast('Copy this link: '+url, 5000);
          }
        }
        document.addEventListener('click', (e)=>{
          const btn = e.target.closest('#hero-share');
          if(!btn) return;
          const heroLink = document.querySelector('#homepage-articles a[href*="LLD-Article-Page.html?id="]');
            const url = heroLink ? heroLink.href : location.href;
            const title = heroLink ? heroLink.textContent.trim() : document.title;
            share(url, title);
        });
        window.__pushToast = pushToast; // expose for other scripts if needed
      })();
    </script>
        <!-- Photo essays: bolder label band -->
        <section class="border border-neutral-200 rounded-sm">
          <header class="bg-neutral-50 border-b border-neutral-200 p-4">
            <h3 class="text-xs smallcaps font-semibold text-neutral-900">Student & Staff Spotlights</h3>
          </header>
          <div id="photo-essays" class="p-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4"></div>
        </section>
        <!-- (Debug index of all articles section removed) -->
      </section>
    </main>
    <!-- Footer: left links + right subscribe (© below), like B -->
    <footer class="border-t border-neutral-200 bg-white">
      <!-- top spacer rule to mimic B's double band -->
      <div class="border-b border-neutral-200"></div>
      <!-- panel bar -->
      <div class="mx-auto max-w-6xl md:max-w-7xl px-4 py-4 bg-neutral-50 border border-neutral-200 rounded-sm mt-2">
        <div class="flex items-center justify-between text-sm text-neutral-700">
          <div class="space-x-3">
            <a href="#" class="hover:text-[var(--brand)]">About</a>
            <span>•</span>
            <a href="#" class="hover:text-[var(--brand)]">Contact</a>
            <span>•</span>
            <a href="#" class="hover:text-[var(--brand)]">Advertise</a>
          </div>
          <a href="LLD-Gallery.html" class="text-[var(--brand)] hover:text-[var(--brand)]">Gallery</a>
        </div>
        <p class="mt-2 text-xs text-neutral-500">Kace Crandall - 2025</p>
      </div>
    </footer>
  
    <script>
      (function(){
        const TZ = 'America/Chicago';
        function formatLongDate(iso){
          try {
            const d = new Date(iso);
            return d.toLocaleDateString('en-US', {weekday:'long', month:'long', day:'numeric', year:'numeric', timeZone: TZ});
          } catch(e){ return ''; }
        }
        function fmtMonthDay(iso){
          try{
            const d = new Date(iso);
            return d.toLocaleDateString('en-US', {month:'short', day:'numeric', timeZone: TZ});
          } catch(e){ return ''; }
        }
        // Immediate local date fill (no SiteMeta dependency)
        (function primeMetaPill(){
          const pill = document.getElementById('meta-pill');
          if(!pill) return;
          const now = new Date();
          // Use the viewer's local timezone (not forced) for perceived correctness
          const dateStr = now.toLocaleDateString(undefined, {weekday:'long', month:'long', day:'numeric', year:'numeric'});
          pill.textContent = dateStr; // initial date only
          pill.dataset.baseDate = dateStr; // stash for later augmentation
        })();
        fetch('SiteMeta.json')
          .then(r => r.json())
          .then(meta => {
            // Top-left meta pill
            const pill = document.getElementById('meta-pill');
            if (pill) {
              const baseDate = pill.dataset.baseDate || formatLongDate(new Date().toISOString());
              const temp = (meta?.meta?.now?.temp ?? meta?.meta?.temp ?? '');
              const unit = (meta?.meta?.unit ?? 'F');
              const loc  = (meta?.meta?.location ?? '');
              const pieces = [baseDate, temp !== '' ? `${temp}°${unit}` : null, loc].filter(Boolean);
              pill.textContent = pieces.join(' • ');
            }

            // Events
            const eventsList = document.getElementById('events-list');
            if (eventsList && Array.isArray(meta?.events)) {
              eventsList.innerHTML = meta.events.map(ev => {
                const when = ev.date ? ' — ' + fmtMonthDay(ev.date) : '';
                return `<li>${ev.title || ''}${when}</li>`;
              }).join('');
            }

            // Weather (sidebar)
            const w = meta?.weather || {};
            const weatherEl = document.getElementById('weather-summary');
            if (weatherEl) {
              if (w.high != null && w.low != null && w.summary) {
                weatherEl.textContent = `High ${w.high}° / Low ${w.low}° • ${w.summary}`;
              } else if (meta?.meta?.now?.temp != null) {
                const unit2 = meta?.meta?.unit ?? 'F';
                const cond  = meta?.meta?.now?.condition ?? '';
                weatherEl.textContent = `${meta.meta.now.temp}°${unit2}${cond ? ' • ' + cond : ''}`;
              } else {
                weatherEl.textContent = '';
              }
            }

            // Scores
            const scoresEl = document.getElementById('scores-section');
            if (scoresEl && Array.isArray(meta?.scores)) {
              scoresEl.innerHTML = meta.scores.map(s => {
                const vs = s.opponent ? ` vs ${s.opponent}` : '';
                const res = s.result || s.score || '';
                return `${s.sport || 'Game'}: ${res}${vs}`;
              }).join('<br>');
            }
          })
          .catch(err => {
            console.error('Failed to load SiteMeta.json', err);
            // Leave the pill with at least the date if fetch fails
          });
      })();
    </script>
</body>
</html>
